/* LÃ³gico TCC: */

CREATE TABLE orcamento (
    id INT NOT NULL PRIMARY KEY,
    nome VARCHAR(255),
    usr_email VARCHAR(255),
    fk_usuario_id INT
);

CREATE TABLE colunas (
    id INT NOT NULL PRIMARY KEY,
    nome VARCHAR(255),
    tipovalor VARCHAR(30),
    operacao VARCHAR(20),
    fk_orcamento_id INT,
    coluna_id INT
);

CREATE TABLE usuario (
    id INT NOT NULL PRIMARY KEY,
    usuario VARCHAR(255),
    senha VARCHAR(255),
    permissao VARCHAR(3),
    email VARCHAR(255)
);

CREATE TABLE modelo_orcamento (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    usr_criador_id INT NOT NULL,
    FOREIGN KEY (usr_criador_id) REFERENCES usuario(id) ON DELETE CASCADE
);
CREATE TABLE modelo_orcamento_dados (
    id INT AUTO_INCREMENT PRIMARY KEY,
    modelo_id INT NOT NULL,
    dados_json LONGTEXT NOT NULL,
    FOREIGN KEY (modelo_id) REFERENCES modelo_orcamento(id) ON DELETE CASCADE
);
CREATE TABLE modelo_orcamento_usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    modelo_id INT NOT NULL,
    usuario_id INT NOT NULL,
    FOREIGN KEY (modelo_id) REFERENCES modelo_orcamento(id) ON DELETE CASCADE,
    FOREIGN KEY (usuario_id) REFERENCES usuario(id) ON DELETE CASCADE
);
 
ALTER TABLE orcamento ADD CONSTRAINT FK_orcamento_2
    FOREIGN KEY (fk_usuario_id)
    REFERENCES usuario (id)
    ON DELETE CASCADE;
 
ALTER TABLE colunas ADD CONSTRAINT FK_colunas_2
    FOREIGN KEY (fk_orcamento_id)
    REFERENCES orcamento (id)
    ON DELETE RESTRICT;
